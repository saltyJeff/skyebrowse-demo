angular.module("app",["app.core","app.page","app.users","app.video","app.profile","app.3dmodel","app.settings","app.contact","app.tutorial","md.data.table","ngStorage","firebase"]),angular.module("app.contact",["ngAnimate","ngAria","ngMessages","app.layout","app.i18n","oc.lazyLoad","ngMaterial","ui.router","duScroll","ngStorage","firebase"]),angular.module("app.3dmodel",["ngAnimate","ngAria","ngMessages","app.layout","app.i18n","oc.lazyLoad","ngMaterial","ui.router","duScroll","ngStorage","firebase"]),angular.module("app.core",["ngAnimate","ngAria","ngMessages","app.layout","app.i18n","oc.lazyLoad","ngMaterial","ui.router","duScroll"]),angular.module("app.layout",[]),angular.module("app.tutorial",["ngAnimate","ngAria","ngMessages","app.layout","app.i18n","oc.lazyLoad","ngMaterial","ui.router","duScroll","ngStorage","firebase"]),angular.module("app.page",[]),angular.module("app.profile",["ngAnimate","ngAria","ngMessages","app.layout","app.i18n","oc.lazyLoad","ngMaterial","ui.router","duScroll","ngStorage","firebase"]),angular.module("app.settings",["ngAnimate","ngAria","ngMessages","app.layout","app.i18n","oc.lazyLoad","ngMaterial","ui.router","duScroll","ngStorage","firebase"]),angular.module("app.video",["ngAnimate","ngAria","ngMessages","app.layout","app.i18n","oc.lazyLoad","ngMaterial","ui.router","duScroll","ngStorage","firebase"]),angular.module("app.users",["ngAnimate","ngAria","ngMessages","app.layout","app.i18n","oc.lazyLoad","ngMaterial","ui.router","duScroll","ngStorage","firebase"]),angular.module("app.contact").controller("contactCtrl",["$scope","$sce","$mdDialog","$rootScope","$localStorage","$firebaseArray","$firebaseObject","$mdToast","$location","$http",function(a,e,t,n,o,s,r,i,l,u){0==o.skybrowselogin&&l.path("/page/signin"),a.contact={};var c={bottom:a.showloading=!1,top:!0,left:!1,right:!0};a.toastPosition=angular.extend({},c),a.getToastPosition=function(){return(e=a.toastPosition).bottom&&c.top&&(e.top=!1),e.top&&c.bottom&&(e.bottom=!1),e.right&&c.left&&(e.left=!1),e.left&&c.right&&(e.right=!1),c=angular.extend({},e),Object.keys(a.toastPosition).filter(function(e){return a.toastPosition[e]}).join(" ");var e};var d=firebase.database().ref("/settings/content"),p=r(d);p.$loaded().then(function(){a.toastdata=p,console.log("toastdata",a.toastdata)}),a.save=function(e){a.showloading=!0;var t={name:e.name,mobile:e.mobile,email:e.email,subject:e.subject,description:e.description};u.post("https://send-mail-node-web.herokuapp.com/contactus/",t).then(function(e){a.showloading=!1,a.contact={},i.show(i.simple().content(a.toastdata.contactmailsenttoast).position(a.getToastPosition()).hideDelay(3e3))}).catch(function(e){console.log(e),a.showloading=!1,i.show(i.simple().content(a.toastdata.contactmailerrtoast).position(a.getToastPosition()).hideDelay(3e3))})}}]).directive("onlyDigits2",[function(){return{require:"ngModel",restrict:"A",link:function(e,t,a,n){n.$parsers.push(function(e){if(e){var t=e.replace(/[^0-9, +, -]/g,"");return t!==e&&(n.$setViewValue(t),n.$render()),parseInt(t,10)}})}}}]),angular.module("app.3dmodel").controller("view3dmodelCtrl",["$scope","$http","$sce","$mdDialog","$rootScope","$localStorage","$firebaseArray","$firebaseObject","$mdToast","$location","$filter",function(d,p,e,t,g,a,n,o,s,r,m){0==a.skybrowselogin&&r.path("/page/signin"),d.curPage=0,d.pageSize=10,d.videosdisplay=[],d.videos=[],d.users=[],d.lieutenant=[],d.chief=[],d.demouser=[],d.officer=[],d.showloading=!1,g.currentuser&&(d.user=g.currentuser),g.$watch("currentuser",function(){d.user=g.currentuser}),!g.currentuser&&a.currentuser&&(g.currentuser=a.currentuser.role,d.user=g.currentuser),console.log(d.user),AWS.config.region="us-east-1",window.bucket=new AWS.S3({params:{Bucket:"skyebrowsebeta"}}),window.bucket;var i={bottom:!1,top:!0,left:!1,right:!0};d.toastPosition=angular.extend({},i),d.getToastPosition=function(){return(e=d.toastPosition).bottom&&i.top&&(e.top=!1),e.top&&i.bottom&&(e.bottom=!1),e.right&&i.left&&(e.left=!1),e.left&&i.right&&(e.right=!1),i=angular.extend({},e),Object.keys(d.toastPosition).filter(function(e){return d.toastPosition[e]}).join(" ");var e},d.openpotree=function(e){g.nowpotreelink=e.displaylink,console.log("nowpotreelink",g.nowpotreelink),r.path("/3dmodel/potreeview")};var l=firebase.database().ref("/settings/content"),u=o(l);u.$loaded().then(function(){d.toastdata=u,console.log("toastdata",d.toastdata)});var f={"Content-Type":"application/json"};g.currentuser.username,g.currentuser.auth_token,d.gotoaddvideo=function(){r.path("/video/addvideo")};var c={username:g.currentuser.username,manager_id:g.currentuser.id,auth_token:g.currentuser.auth_token};p.post("https://api.skyebrowse.com:3000/api/Consumer/getEmployees",c,f).then(function(e){if(console.log("managerdata",e.data.data),3==g.currentuser.access_level){d.users=e.data.data;for(var t=0;t<d.users.length;t++)d.users[t].manager_id=g.currentuser.id,d.users[t].manager_username=g.currentuser.username}else if(4==g.currentuser.access_level){d.lieutenant=e.data.data;var o=0,a=d.lieutenant.length;function s(){if(o<a){d.lieutenant[o].manager_id=g.currentuser.id,d.lieutenant[o].manager_username=g.currentuser.username;var n={username:d.lieutenant[o].username,manager_id:d.lieutenant[o].id,auth_token:d.lieutenant[o].auth_token};p.post("https://api.skyebrowse.com:3000/api/Consumer/getEmployees",n,f).then(function(e){console.log("lieutenant res data",e.data.data);for(var t=e.data.data,a=0;a<t.length;a++)t[a].manager_id=n.manager_id,t[a].manager_username=n.username,d.officer.push(t[a]);o+=1,s()},function(e){console.log("lieutenant err",e),o+=1,s()})}}s();for(var n=0;n<d.lieutenant.length;n++)d.users.push(d.lieutenant[n]);for(var r=0;r<d.officer.length;r++)d.users.push(d.officer[r])}else if(5==g.currentuser.access_level){for(var i=e.data.data,l=0;l<i.length;l++)1==i[l].access_level?(i[l].manager_id=g.currentuser.id,i[l].manager_username=g.currentuser.username,d.demouser.push(i[l])):4==i[l].access_level&&d.chief.push(i[l]);var o=0,a=d.chief.length;function s(){if(o<a){d.chief[o].manager_id=g.currentuser.id,d.chief[o].manager_username=g.currentuser.username;var n={username:d.chief[o].username,manager_id:d.chief[o].id,auth_token:d.chief[o].auth_token};p.post("https://api.skyebrowse.com:3000/api/Consumer/getEmployees",n,f).then(function(e){console.log("chief res data",e.data.data);for(var t=e.data.data,a=0;a<t.length;a++)t[a].manager_id=n.manager_id,t[a].manager_username=n.username,d.lieutenant.push(t[a]);o+=1,s()},function(e){console.log("chief err",e),o+=1,s()})}else{var u=0,c=d.lieutenant.length;!function n(){if(u<c){var o={username:d.lieutenant[u].username,manager_id:d.lieutenant[u].id,auth_token:d.lieutenant[u].auth_token};p.post("https://api.skyebrowse.com:3000/api/Consumer/getEmployees",o,f).then(function(e){console.log("lieutenant res data",e.data.data);for(var t=e.data.data,a=0;a<t.length;a++)t[a].manager_id=o.manager_id,t[a].manager_username=o.username,d.officer.push(t[a]);u+=1,n()},function(e){console.log("lieutenant err",e),u+=1,n()})}else{for(var e=0;e<d.chief.length;e++)d.users.push(d.chief[e]);for(var t=0;t<d.lieutenant.length;t++)d.users.push(d.lieutenant[t]);for(var a=0;a<d.officer.length;a++)d.users.push(d.officer[a]);for(var s=0;s<d.demouser.length;s++)d.users.push(d.demouser[s]);d.users.push(g.currentuser),console.log("$scope.users",d.users);var r=0,i=d.users.length;function l(){if(console.log("inside callmenow"),r<i){console.log("inside callmenow if");var e={"Content-Type":"application/json"},t={username:d.users[r].username,auth_token:d.users[r].auth_token};console.log("senddata",t),p.post("https://api.skyebrowse.com:3000/api/UserModels/fetchAllModels",t,e).then(function(e){console.log("get files",e);for(var t=e.data.data,a=0;a<t.length;a++)t[a].created_on=m("date")(t[a].created_on,"dd/MM/yyyy @ h:mma"),d.videos.push(t[a]);r+=1,l()},function(e){console.log("err file get",e),r+=1,l()})}else{for(var a=0;a<d.videos.length;a++)d.videosdisplay.push(d.videos[a]);console.log("videos display",d.videosdisplay)}}l()}}()}}s()}},function(e){console.log("managerdata err",e)}),d.numberOfPages=function(e){console.log(e,d.videosdisplay.length),d.pageSize=parseInt(e),d.pagenum=Math.ceil(d.videosdisplay.length/parseInt(e))}}]).filter("pagination",[function(){return function(e,t){return t=+t,e.slice(t)}}]).filter("trusted",[function(t){return function(e){return t.trustAsResourceUrl(e)}}]),angular.module("app.core").factory("appConfig",[function(){var e=[{name:"Fade up",class:"animate-fade-up"},{name:"Scale up",class:"ainmate-scale-up"},{name:"Slide in from right",class:"ainmate-slide-in-right"},{name:"Flip Y",class:"animate-flip-y"}];firebase.initializeApp({apiKey:"AIzaSyCL5Ew144JnXK8_jdcArOvG0zpZCi84LKk",authDomain:"webtoall-demo-project.firebaseapp.com",databaseURL:"https://webtoall-demo-project.firebaseio.com",projectId:"webtoall-demo-project",storageBucket:"webtoall-demo-project.appspot.com",messagingSenderId:"7846042188"});var t=(new Date).getFullYear();return{pageTransitionOpts:e,main:{brand:"Material",name:"Lisa",year:t,layout:"wide",menu:"vertical",isMenuCollapsed:!1,fixedHeader:!0,fixedSidebar:!0,pageTransition:e[0],skin:"12",link:"https://themeforest.net/item/material-design-admin-with-angularjs/13582227"},color:{primary:"#1BAACC",success:"#8BC34A",info:"#00BCD4",infoAlt:"#7E57C2",warning:"#FFCA28",danger:"#F44336",text:"#3D4051",gray:"#EDF0F1"}}}]).config(["$mdThemingProvider",function(e){var t=e.extendPalette("cyan",{contrastLightColors:"500 600 700 800 900",contrastStrongLightColors:"500 600 700 800 900"}),a=e.extendPalette("light-green",{contrastLightColors:"500 600 700 800 900",contrastStrongLightColors:"500 600 700 800 900"});e.definePalette("cyanAlt",t).definePalette("lightGreenAlt",a),e.theme("default").primaryPalette("teal",{default:"500"}).accentPalette("cyanAlt",{default:"500"}).warnPalette("red",{default:"500"}).backgroundPalette("grey")}]),angular.module("app").controller("AppCtrl",["$scope","$rootScope","$state","$document","appConfig",function(a,n,e,o,t){a.pageTransitionOpts=t.pageTransitionOpts,a.main=t.main,a.color=t.color,a.$watch("main",function(e,t){"horizontal"===e.menu&&"vertical"===t.menu&&n.$broadcast("nav:reset"),!1===e.fixedHeader&&!0===e.fixedSidebar&&(!1===t.fixedHeader&&!1===t.fixedSidebar&&(a.main.fixedHeader=!0,a.main.fixedSidebar=!0),!0===t.fixedHeader&&!0===t.fixedSidebar&&(a.main.fixedHeader=!1,a.main.fixedSidebar=!1)),!0===e.fixedSidebar&&(a.main.fixedHeader=!0),!1===e.fixedHeader&&(a.main.fixedSidebar=!1)},!0),n.$on("$stateChangeSuccess",function(e,t,a){o.scrollTo(0,0)})}]),angular.module("app").config(["$ocLazyLoadProvider",function(e){e.config({debug:!1,events:!1,modules:[{name:"fontawesome",files:["node_modules/font-awesome/css/font-awesome.css"]},{name:"weather-icons",files:["node_modules/weather-icons/css/weather-icons.min.css"]},{name:"angular-material-data-table",files:["node_modules/angular-material-data-table/dist/md-data-table.min.js"]},{name:"angular-wizard",files:["node_modules/angular-wizard/dist/angular-wizard.min.js"]},{name:"email",files:["app/email/email.module.js","app/email/email.controller.js","app/email/email.service.js"],serie:!0},{name:"googlemap",files:["js!http://maps.google.com/maps/api/js","node_modules/ngmap/build/scripts/ng-map.min.js"]},{name:"fullcalendar",files:["node_modules/moment/min/moment.min.js","node_modules/fullcalendar/dist/fullcalendar.min.js","node_modules/angular-ui-calendar/src/calendar.js"],serie:!0}]})}]),angular.module("app").config(["$stateProvider","$urlRouterProvider","$ocLazyLoadProvider",function(a,e,t){var n;n=function(e){var t;return t={url:"/"+e,templateUrl:"app/"+e+".html"},a.state(e,t),a},["page/forgot-password","page/signin","users/adduser","users/viewuser","video/addvideo","video/viewvideo","3dmodel/view3dmodel","3dmodel/potreeview","settings/settings","settings/emailsettings","app/page/update-password","contact/contactus","tutorial/viewtutorial"].forEach(function(e){return n(e)}),a.state("dashboard",{url:"/dashboard",templateUrl:"app/dashboard/dashboard.html"}).state("profile",{url:"/profile",templateUrl:"app/profile/profile.html"}).state("settings",{url:"/settings",templateUrl:"app/settings/settings.html"}).state("emailsettings",{url:"/emailsettings",templateUrl:"app/settings/emailsettings.html"}).state("adduser",{url:"/adduser",templateUrl:"app/users/adduser.html"}).state("viewuser",{url:"/viewuser",templateUrl:"app/users/viewuser.html"}).state("edituser",{url:"/edituser/:username",templateUrl:"app/users/edituser.html"}).state("update",{url:"/update/:username/:id",templateUrl:"app/page/update-password.html"}),e.when("/","/page/signin").otherwise("/page/signin")}]),angular.module("app.i18n",["pascalprecht.translate"]).config(["$translateProvider",function(e){e.useStaticFilesLoader({prefix:"assets/i18n/",suffix:".json"}),e.preferredLanguage("en"),e.useSanitizeValueStrategy(null)}]).controller("LangCtrl",["$scope","$translate",function(t,a){t.activeLang="english",t.setLang=function(e){switch(e){case"english":a.use("en");break;case"spanish":a.use("es");break;case"chinese":a.use("zh");break;case"japanese":a.use("ja")}return t.activeLang=e},t.langs=["english","spanish","chinese","japanese"]}]),angular.module("app").controller("DashboardCtrl",["$scope","$sce","$filter","$mdDialog","$rootScope","$localStorage","$firebaseArray","$firebaseObject","$location","$http",function(d,e,p,t,g,a,n,o,s,m){0==a.skybrowselogin&&s.path("/page/signin"),d.curPage=0,d.pageSize=10,d.videosdisplay=[],d.videos=[],d.users=[],d.lieutenant=[],d.chief=[],d.demouser=[],d.officer=[],d.showloading=!1,g.currentuser&&(d.user=g.currentuser),g.$watch("currentuser",function(){d.user=g.currentuser}),!g.currentuser&&a.currentuser&&(g.currentuser=a.currentuser.role,d.user=g.currentuser),console.log(d.user),AWS.config.region="us-east-1",new AWS.S3({params:{Bucket:"test3dmodel"}});var r={bottom:!1,top:!0,left:!1,right:!0};d.toastPosition=angular.extend({},r),d.getToastPosition=function(){return(e=d.toastPosition).bottom&&r.top&&(e.top=!1),e.top&&r.bottom&&(e.bottom=!1),e.right&&r.left&&(e.left=!1),e.left&&r.right&&(e.right=!1),r=angular.extend({},e),Object.keys(d.toastPosition).filter(function(e){return d.toastPosition[e]}).join(" ");var e},d.openpotree=function(e){g.nowpotreelink=e.displaylink,console.log("nowpotreelink",g.nowpotreelink),s.path("/3dmodel/potreeview")};var i=firebase.database().ref("/settings/content"),l=o(i);l.$loaded().then(function(){d.toastdata=l,console.log("toastdata",d.toastdata)});var f={"Content-Type":"application/json"};g.currentuser.username,g.currentuser.auth_token,d.gotoaddvideo=function(){s.path("/video/addvideo")};var u={username:g.currentuser.username,manager_id:g.currentuser.id,auth_token:g.currentuser.auth_token};m.post("https://api.skyebrowse.com:3000/api/Consumer/getEmployees",u,f).then(function(e){if(console.log("managerdata",e.data.data),d.showloading=!0,3==g.currentuser.access_level){d.users=e.data.data;for(var t=0;t<d.users.length;t++)d.users[t].manager_id=g.currentuser.id,d.users[t].manager_username=g.currentuser.username}else if(4==g.currentuser.access_level){d.lieutenant=e.data.data;var o=0,a=d.lieutenant.length;function s(){if(o<a){d.lieutenant[o].manager_id=g.currentuser.id,d.lieutenant[o].manager_username=g.currentuser.username;var n={username:d.lieutenant[o].username,manager_id:d.lieutenant[o].id,auth_token:d.lieutenant[o].auth_token};m.post("https://api.skyebrowse.com:3000/api/Consumer/getEmployees",n,f).then(function(e){console.log("lieutenant res data",e.data.data);for(var t=e.data.data,a=0;a<t.length;a++)t[a].manager_id=n.manager_id,t[a].manager_username=n.username,d.officer.push(t[a]);o+=1,s()},function(e){console.log("lieutenant err",e),o+=1,s()})}}s();for(var n=0;n<d.lieutenant.length;n++)d.users.push(d.lieutenant[n]);for(var r=0;r<d.officer.length;r++)d.users.push(d.officer[r])}else if(5==g.currentuser.access_level){for(var i=e.data.data,l=0;l<i.length;l++)1==i[l].access_level?(i[l].manager_id=g.currentuser.id,i[l].manager_username=g.currentuser.username,d.demouser.push(i[l])):4==i[l].access_level&&d.chief.push(i[l]);var o=0,a=d.chief.length;function s(){if(o<a){d.chief[o].manager_id=g.currentuser.id,d.chief[o].manager_username=g.currentuser.username;var n={username:d.chief[o].username,manager_id:d.chief[o].id,auth_token:d.chief[o].auth_token};m.post("https://api.skyebrowse.com:3000/api/Consumer/getEmployees",n,f).then(function(e){console.log("chief res data",e.data.data);for(var t=e.data.data,a=0;a<t.length;a++)t[a].manager_id=n.manager_id,t[a].manager_username=n.username,d.lieutenant.push(t[a]);o+=1,s()},function(e){console.log("chief err",e),o+=1,s()})}else{var u=0,c=d.lieutenant.length;!function n(){if(u<c){var o={username:d.lieutenant[u].username,manager_id:d.lieutenant[u].id,auth_token:d.lieutenant[u].auth_token};m.post("https://api.skyebrowse.com:3000/api/Consumer/getEmployees",o,f).then(function(e){console.log("lieutenant res data",e.data.data);for(var t=e.data.data,a=0;a<t.length;a++)t[a].manager_id=o.manager_id,t[a].manager_username=o.username,d.officer.push(t[a]);u+=1,n()},function(e){console.log("lieutenant err",e),u+=1,n()})}else{for(var e=0;e<d.chief.length;e++)d.users.push(d.chief[e]);for(var t=0;t<d.lieutenant.length;t++)d.users.push(d.lieutenant[t]);for(var a=0;a<d.officer.length;a++)d.users.push(d.officer[a]);for(var s=0;s<d.demouser.length;s++)d.users.push(d.demouser[s]);d.users.push(g.currentuser),console.log("$scope.users",d.users);var r=0,i=d.users.length;function l(){if(console.log("inside callmenow"),r<i){console.log("inside callmenow if");var e={"Content-Type":"application/json"},t={username:d.users[r].username,auth_token:d.users[r].auth_token};console.log("senddata",t),m.post("https://api.skyebrowse.com:3000/api/UserModels/fetchAllModels",t,e).then(function(e){if(console.log("get files",e),0!=e.data.data.length){for(var t=e.data.data.url,a=0;a<t.length;a++)t[a].created_on=p("date")(t[a].created_on,"dd/MM/yyyy @ h:mma"),d.videos.push(t[a]);r+=1,l()}else r+=1,l()},function(e){console.log("err file get",e),r+=1,l()})}else{for(var a=0;a<d.videos.length;a++)d.videosdisplay.push(d.videos[a]);console.log("videos display",d.videosdisplay),d.showloading=!1,d.videos.length&&(d.pagenum=Math.ceil(d.videos.length/d.pageSize))}}l()}}()}}s()}},function(e){console.log("managerdata err",e)}),d.numberOfPages=function(e){console.log(e,d.videosdisplay.length),d.pageSize=parseInt(e),d.pagenum=Math.ceil(d.videosdisplay.length/parseInt(e))}}]).filter("trusted",["$sce",function(t){return function(e){return t.trustAsResourceUrl(e)}}]),angular.module("app.layout").controller("CustomizerCtrl",["$scope",function(e){}]).controller("headerCtrl",["$scope","$firebaseArray","$firebaseObject","$localStorage","$rootScope",function(e,t,a,n,o){}]).controller("sidebarCtrl",["$scope","$firebaseArray","$firebaseObject","$localStorage","$rootScope",function(e,t,a,n,o){o.currentuser&&(e.user=o.currentuser),o.$watch("currentuser",function(){e.user=o.currentuser}),!o.currentuser&&n.currentuser&&(o.currentuser=n.currentuser,e.user=o.currentuser),console.log(e.user)}]),angular.module("app.layout").directive("toggleQuickview",function(){return{restrict:"A",link:function(e,t,a){var n=$(t[0]),o=$("#app");n.on("click",function(e){var t="quickview-open";if(a.target)var t=t+"-"+a.target;o.toggleClass(t),e.preventDefault()})}}}).directive("uiPreloader",["$rootScope",function(e){return{restrict:"A",template:'<span class="bar"></span>',link:function(e,o,t){o.addClass("preloaderbar hide"),e.$on("$stateChangeStart",function(e){o.removeClass("hide").addClass("active")}),e.$on("$stateChangeSuccess",function(e,t,a,n){e.targetScope.$watch("$viewContentLoaded",function(){o.addClass("hide").removeClass("active")})}),e.$on("preloader:active",function(e){o.removeClass("hide").addClass("active")}),e.$on("preloader:hide",function(e){o.addClass("hide").removeClass("active")})}}}]),function(){function e(){$("#loader-container").fadeOut("slow")}$(window).on("load",function(){setTimeout(e,1e3)})}(),angular.module("app.layout").directive("toggleNavCollapsedMin",["$rootScope",function(o){return{restrict:"A",link:function(e,t,a){var n;n=$("#app"),t.on("click",function(e){return n.hasClass("nav-collapsed-min")?n.removeClass("nav-collapsed-min"):(n.addClass("nav-collapsed-min"),o.$broadcast("nav:reset")),e.preventDefault()})}}}]).directive("collapseNav",function(){return{restrict:"A",link:function(e,t,a){var n,o,s,r,i,l,u,c,d;u=$(window),(r=t.find("ul").parent("li")).append('<i class="material-icons icon-has-ul-h">keyboard_arrow_down</i>'),(n=r.children("a")).append('<i class="material-icons icon-has-ul">keyboard_arrow_down</i>'),i=t.children("li").not(r),o=i.children("a"),s=$("#app"),l=$("#nav-container"),n.on("click",function(e){var t,a;if(s.hasClass("nav-collapsed-min")||l.hasClass("nav-horizontal")&&768<=u.width())return!1;a=$(this),t=a.parent("li"),r.not(t).removeClass("open").find("ul").slideUp(250),t.toggleClass("open").find("ul").stop().slideToggle(250),e.preventDefault()}),o.on("click",function(e){r.removeClass("open").find("ul").slideUp(250)}),e.$on("nav:reset",function(e){r.removeClass("open").find("ul").slideUp(250)}),c=u.width(),d=function(){var e;(e=u.width())<768&&s.removeClass("nav-collapsed-min"),c<768&&768<=e&&l.hasClass("nav-horizontal")&&r.removeClass("open").find("ul").slideUp(250),c=e},u.resize(function(){var e;clearTimeout(e),e=setTimeout(d,300)})}}}).directive("highlightActive",function(){return{restrict:"A",controller:["$scope","$element","$attrs","$location",function(e,t,a,n){var o,s,r;s=t.find("a"),r=function(){return n.path()},(o=function(e,o){return o="#!"+o,angular.forEach(e,function(e){var t,a,n;if(a=angular.element(e),t=a.parent("li"),n=a.attr("href"),t.hasClass("active")&&t.removeClass("active"),0===o.indexOf(n))return t.addClass("active")})})(s,n.path()),e.$watch(r,function(e,t){if(e!==t)return o(s,n.path())})}]}}).directive("toggleOffCanvas",function(){return{restrict:"A",link:function(e,t,a){t.on("click",function(){return $("#app").toggleClass("on-canvas")})}}}),angular.module("app.tutorial").controller("viewtutorialCtrl",["$scope","$sce","$mdDialog","$rootScope","$localStorage","$firebaseArray","$firebaseObject","$location",function(e,t,a,n,o,s,r,i){console.log("inside viewtutorialCtrl"),0==o.skybrowselogin&&i.path("/page/signin")}]).filter("trusted1",["$sce",function(t){return function(e){return t.trustAsResourceUrl(e)}}]),angular.module("app.page").controller("invoiceCtrl",["$scope","$window",function(e,t){var a,n;e.printInvoice=function(){a=document.getElementById("invoice").innerHTML,document.body.innerHTML,(n=window.open()).document.open(),n.document.write('<html><head><link rel="stylesheet" type="text/css" href="styles/main.css" /></head><body onload="window.print()">'+a+"</html>"),n.document.close()}}]).controller("authCtrl",["$scope","$window","$location","$state","$mdDialog","$firebaseObject","$firebaseArray","$localStorage","$rootScope","$http",function(t,e,a,n,o,s,r,i,l,u){t.inputType="password",t.hideshow=!0,t.hideShowPassword=function(){t.hideshow=!t.hideshow,"password"==t.inputType?t.inputType="text":t.inputType="password"},t.user={},i.currentuser=void 0,i.skybrowselogin=!1,l.currentuser=null;var c=firebase.database().ref("/settings/content"),d=s(c);d.$loaded().then(function(){t.toastdata=d,console.log("toastdata",t.toastdata)}),t.login=function(e){e.username&&e.password?u.post("https://api.skyebrowse.com:3000/api/Consumer/signin",e,{"Content-Type":"application/json"}).then(function(e){console.log("res",e),1==e.data.success?(i.skybrowselogin=!0,i.currentuser=e.data.data,l.currentuser=e.data.data,console.log("login",l.currentuser),a.path("/dashboard")):(o.show(o.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("Alert").content(t.toastdata.loginerrortoast).ariaLabel("Alert").ok("OK")),t.user={})},function(e){o.show(o.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("Alert").content("Can't  able to reach server. Try again later.").ariaLabel("Alert").ok("OK"))}):o.show(o.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("Alert").content(t.toastdata.usernamepasswordreqtoast).ariaLabel("Alert").ok("OK"))}}]).controller("updateCtrl",["$scope","$window","$location","$state","$mdDialog","$firebaseObject","$firebaseArray","$localStorage","$rootScope","$stateParams",function(a,e,n,t,o,s,r,i,l,u){console.log(u.id,u.username),a.user={};var c=firebase.database().ref("/users/"+u.id),d=s(c);d.$loaded().then(function(){0==d.isauth?a.display=!0:a.display=!1}),a.inputType="password",a.hideshow=!0,a.hideShowPassword=function(){a.hideshow=!a.hideshow,"password"==a.inputType?a.inputType="text":a.inputType="password"},a.inputType1="password",a.hideshow1=!0,a.hideShowPassword1=function(){a.hideshow1=!a.hideshow1,"password"==a.inputType1?a.inputType1="text":a.inputType1="password"},a.changepassword=function(e){if(e.password&&e.confirmpassword)if(e.password==e.confirmpassword){var t=firebase.database().ref("/users/"+u.id);t.child("password").set(e.password),t.child("isauth").set(!0),n.path("/page/signin")}else o.show(o.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("Alert").content(a.toastdata.passworderrortoast).ariaLabel("Alert").ok("OK"));else o.show(o.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("Alert").content(a.toastdata.passwordreqtoast).ariaLabel("Alert").ok("OK"))}}]).directive("ngEnter",[function(){return function(t,e,a){e.bind("keydown keypress",function(e){13===e.which&&(t.$apply(function(){t.$eval(a.ngEnter)}),e.preventDefault())})}}]),angular.module("app.page").directive("customPage",function(){return{restrict:"A",controller:["$scope","$element","$location",function(e,o,a){var n,t;t=function(){return a.path()},(n=function(e){console.log("path",e);var t,a,n=e.split("/");switch(console.log("data",n[1]),"update"==n[1]&&(t=n[2],a=n[3]),o.removeClass("on-canvas"),o.removeClass("body-wide body-err body-lock body-auth"),e){case"/404":case"/page/404":case"/page/500":return o.addClass("body-wide body-err");case"/page/signin":case"/page/signup":case"/page/forgot-password":case"/update/"+t+"/"+a:return o.addClass("body-wide body-auth");case"/page/lock-screen":return o.addClass("body-wide body-lock")}})(a.path()),e.$watch(t,function(e,t){if(e!==t)return n(a.path())})}]}}),angular.module("app.profile").controller("profileCtrl",["$scope","$stateParams","$firebaseArray","$firebaseObject","$localStorage","$mdToast","$rootScope","$location",function(r,e,t,a,i,n,o,s){0==i.skybrowselogin&&s.path("/page/signin"),i.userimage1={},r.user={},r.image1={},r.showdiv=!1,r.inputType="password",r.hideshow=!0;var l={bottom:!(r.hideShowPassword=function(){r.hideshow=!r.hideshow,"password"==r.inputType?r.inputType="text":r.inputType="password"}),top:!0,left:!1,right:!0};r.toastPosition=angular.extend({},l),r.getToastPosition=function(){return(e=r.toastPosition).bottom&&l.top&&(e.top=!1),e.top&&l.bottom&&(e.bottom=!1),e.right&&l.left&&(e.left=!1),e.left&&l.right&&(e.right=!1),l=angular.extend({},e),Object.keys(r.toastPosition).filter(function(e){return r.toastPosition[e]}).join(" ");var e},r.roles=[{text:"Police Chief",value:"Police Chief"},{text:"Police Department",value:"Police Department"},{text:"User",value:"User"}];var u=firebase.database().ref("/users"),c=t(u);c.$loaded().then(function(){r.users=c;for(var e=0;e<r.users.length;e++)r.users[e].username==i.currentuser.username&&(r.user=r.users[e])});var d=firebase.database().ref("/settings/content"),p=a(d);p.$loaded().then(function(){r.toastdata=p,console.log("toastdata",r.toastdata)});var g=-1;r.imgFile=function(e){var s,t=e.target.files[0];console.log("inside imgFile"),g=parseInt(g)+1,console.log("call",g),console.log(" profile imageFile",t),"image/png"==t.type||"image/jpg"==t.type||"image/jpeg"==t.type?(console.log("if"),s=t,new Promise(function(e,t){if(console.log("$scope.user.image",r.user.image),console.log("$localStorage.userimage1",i.userimage1),void 0!==r.user.image){if(void 0!==r.user.image.url){console.log("inside if");var a=firebase.storage().refFromURL(r.user.image.url);a.delete().then(function(){console.log("successfully deleted"),r.user.image={};var e=firebase.storage().ref("users/"+s.name),a=e.put(s);a.on("state_changed",function(e){},function(e){},function(){var e=a.snapshot.downloadURL,t={name:s.name,url:e};console.log(t),r.showdiv=!1,i.userimage1=t,r.$apply(function(){r.image1=i.userimage1})})}).catch(function(e){console.log("error",e)})}}else if(0!==Object.keys(i.userimage1).length){console.log("inside else if"),console.log("$localStorage.userimage1.url",i.userimage1.url);var a=firebase.storage().refFromURL(i.userimage1.url);a.delete().then(function(){console.log("successfully deleted"),i.userimage1={},r.image1={};var e=firebase.storage().ref("users/"+s.name),a=e.put(s);a.on("state_changed",function(e){},function(e){},function(){var e=a.snapshot.downloadURL,t={name:s.name,url:e};console.log(t),r.showdiv=!1,i.userimage1=t,r.$apply(function(){r.image1=i.userimage1})})}).catch(function(e){console.log("error",e)})}else{console.log("inside else");var n=firebase.storage().ref("users/"+s.name),o=n.put(s);o.on("state_changed",function(e){},function(e){},function(){var e=o.snapshot.downloadURL,t={name:s.name,url:e};console.log(t),r.showdiv=!1,i.userimage1=t,r.$apply(function(){r.image1=i.userimage1})})}}),r.$apply(function(){null!=t&&(r.showdiv=!0)})):0==parseInt(g%2)&&(console.log("else"),n.show(n.simple().content(r.toastdata.imgvalidatetoast).position(r.getToastPosition()).hideDelay(3e3)),t=null)},r.updateprofile=function(e){var t=firebase.database().ref("/users/"+r.user.$id);t.child("name").set(e.name),t.child("mobile").set(e.mobile),t.child("role").set(e.role),t.child("username").set(e.username),t.child("password").set(e.password),t.child("gender").set(e.gender),e.email&&t.child("email").set(e.email),0!==Object.keys(i.userimage1).length&&(t.child("image").set(i.userimage1),o.image=i.userimage1.url),n.show(n.simple().content(r.toastdata.profileupdatetoast).position(r.getToastPosition()).hideDelay(3e3)),i.userimage1={},r.image1={},s.path("/dashboard")}}]).directive("customOnChange",[function(){return{restrict:"A",link:function(e,t,a){console.log("inside directive");var n=e.$eval(a.customOnChange);t.on("change",n),t.on("$destroy",function(){t.off()})}}}]).directive("onlyDigits1",[function(){return{require:"ngModel",restrict:"A",link:function(e,t,a,n){n.$parsers.push(function(e){if(e){var t=e.replace(/[^0-9, +]/g,"");return t!==e&&(n.$setViewValue(t),n.$render()),parseInt(t,10)}})}}}]),angular.module("app.settings").controller("settingsCtrl",["$scope","$stateParams","$firebaseArray","$firebaseObject","$localStorage","$mdToast","$rootScope","$location","$mdDialog",function(o,e,s,t,a,r,n,i,l){0!=a.skybrowselogin&&"Admin"==a.currentuser.role||i.path("/page/signin"),o.curPage=0,o.pageSize=5,o.stateName="";var u={bottom:!(o.states=[]),top:!0,left:!1,right:!0};o.toastPosition=angular.extend({},u),o.getToastPosition=function(){return(e=o.toastPosition).bottom&&u.top&&(e.top=!1),e.top&&u.bottom&&(e.bottom=!1),e.right&&u.left&&(e.left=!1),e.left&&u.right&&(e.right=!1),u=angular.extend({},e),Object.keys(o.toastPosition).filter(function(e){return o.toastPosition[e]}).join(" ");var e};var c=firebase.database().ref("/settings/content"),d=t(c);d.$loaded().then(function(){o.toastdata=d,console.log("toastdata",o.toastdata)});var p=firebase.database().ref("/emailsettings"),g=t(p);g.$loaded().then(function(){o.mail=g,console.log("maildata",o.mail)});var m=firebase.database().ref("/settings/states"),f=s(m);f.$loaded().then(function(){o.states=f;for(var e=0;e<o.states.length;e++)o.states[e].id=parseInt(e)+1,o.states[e].viewedit=!1;console.log("states",o.states),o.states.length&&(o.pagenum=Math.ceil(o.states.length/o.pageSize),console.log("pagenum",o.pagenum))}),o.numberOfPages=function(e){o.pageSize=parseInt(e),o.pagenum=Math.ceil(o.states.length/parseInt(e))},o.inputType="password",o.hideshow=!0,o.hideShowPassword=function(){o.hideshow=!o.hideshow,"password"==o.inputType?o.inputType="text":o.inputType="password"},o.editstate=function(e){o.nowstate={},o.nowstate=e,o.nowstate.viewedit=!0,console.log("nowstate",o.nowstate)},o.savestate=function(e){console.log("state data",e);var t=firebase.database().ref("/settings/states");t.push({statename:e}),o.stateName="",r.show(r.simple().content(o.toastdata.addstatetoast).position(o.getToastPosition()).hideDelay(3e3));var a=firebase.database().ref("/settings/states"),n=s(a);n.$loaded().then(function(){o.states=n;for(var e=0;e<o.states.length;e++)o.states[e].id=parseInt(e)+1,o.states[e].viewedit=!1;console.log("states",o.states),o.states.length&&(o.pagenum=Math.ceil(o.states.length/o.pageSize),console.log("pagenum",o.pagenum))})},o.delete=function(n){var e=l.confirm().title("Confirmation").content(o.toastdata.deletestateconfirmtext).ok("Yes").cancel("No");l.show(e).then(function(){var e=firebase.database().ref("/settings/states/"+n.$id);e.set({});var t=firebase.database().ref("/settings/states"),a=s(t);a.$loaded().then(function(){o.states=a;for(var e=0;e<o.states.length;e++)o.states[e].id=parseInt(e)+1,o.states[e].viewedit=!1;console.log("states",o.states),o.states.length&&(o.pagenum=Math.ceil(o.states.length/o.pageSize),console.log("pagenum",o.pagenum)),l.hide(),r.show(r.simple().content(o.toastdata.deletestatetoast).position(o.getToastPosition()).hideDelay(3e3))})},function(){})},o.updatesettings=function(e){console.log("update data",e),console.log("imgvalidatetoast data",e.imgvalidatetoast);var t=firebase.database().ref("/settings/content");t.child("addusertoast").set(e.addusertoast),t.child("updateusertoast").set(e.updateusertoast),t.child("deleteusertoast").set(e.deleteusertoast),t.child("deleteuserconfirmtext").set(e.deleteuserconfirmtext),t.child("addvideotoast").set(e.addvideotoast),t.child("deletevideotoast").set(e.deletevideotoast),t.child("deletevideoconfirmtext").set(e.deletevideoconfirmtext),t.child("profileupdatetoast").set(e.profileupdatetoast),t.child("settingsupdatetoast").set(e.settingsupdatetoast),t.child("addstatetoast").set(e.addstatetoast),t.child("updatestatetoast").set(e.updatestatetoast),t.child("deletestatetoast").set(e.deletestatetoast),t.child("deletestateconfirmtext").set(e.deletestateconfirmtext),t.child("imgvalidatetoast").set(e.imgvalidatetoast),t.child("usernamevalidatetoast").set(e.usernamevalidatetoast),t.child("emailvalidatetoast").set(e.emailvalidatetoast),t.child("mailsenttoast").set(e.mailsenttoast),t.child("mailresenttoast").set(e.mailresenttoast),t.child("uploadvideotoast").set(e.uploadvideotoast),t.child("videofilevalidatetoast").set(e.videofilevalidatetoast),t.child("videofilesizetoast").set(e.videofilesizetoast),t.child("loginerrortoast").set(e.loginerrortoast),t.child("usernamepasswordreqtoast").set(e.usernamepasswordreqtoast),t.child("passworderrortoast").set(e.passworderrortoast),t.child("passwordreqtoast").set(e.passwordreqtoast),t.child("contactmailsenttoast").set(e.contactmailsenttoast),t.child("contactmailerrtoast").set(e.contactmailerrtoast),r.show(r.simple().content(o.toastdata.settingsupdatetoast).position(o.getToastPosition()).hideDelay(3e3))},o.showdetail=function(e,t){console.log("data",t),l.show({controller:["$scope","$mdDialog","nowstate",function(e,t,a){e.nowstate=a,e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(e){t.hide(e)}}],templateUrl:"dialog2.tmpl.html",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,fullscreen:o.customFullscreen,scope:o,preserveScope:!0,locals:{nowstate:t}}).then(function(e){o.status='You said the information was "'+e+'".'},function(){o.status="You cancelled the dialog."})},o.updatestate=function(e){console.log("data",e);var t=firebase.database().ref("/settings/states/"+e.$id);t.child("statename").set(e.statename),r.show(r.simple().content(o.toastdata.updatestatetoast).position(o.getToastPosition()).hideDelay(3e3));var a=firebase.database().ref("/settings/states"),n=s(a);n.$loaded().then(function(){o.states=n;for(var e=0;e<o.states.length;e++)o.states[e].id=parseInt(e)+1,o.states[e].viewedit=!1;console.log("states",o.states),o.states.length&&(o.pagenum=Math.ceil(o.states.length/o.pageSize),console.log("pagenum",o.pagenum))})},o.updateemailsettings=function(e){var t=firebase.database().ref("/emailsettings");t.child("username").set(e.username),t.child("email").set(e.email),t.child("password").set(e.password),r.show(r.simple().content(o.toastdata.settingsupdatetoast).position(o.getToastPosition()).hideDelay(3e3)),i.path("/dashboard")}}]),angular.module("app.video").controller("viewvideoCtrl",["$scope","$http","$sce","$mdDialog","$rootScope","$localStorage","$mdToast","$filter","$location","$firebaseArray","$firebaseObject",function(r,i,e,t,l,a,u,n,c,o,s){0==a.skybrowselogin&&c.path("/page/signin"),r.curPage=0,r.pageSize=10,r.showloading=!1,r.video={},l.filename="",r.maxDate=new Date,console.log("$scope.maxDate",r.maxDate),l.currentuser&&(r.user=l.currentuser),l.$watch("currentuser",function(){r.user=l.currentuser}),!l.currentuser&&a.currentuser&&(l.currentuser=a.currentuser.role,r.user=l.currentuser),console.log(r.user);var d={bottom:!1,top:!0,left:!1,right:!0};r.toastPosition=angular.extend({},d),r.getToastPosition=function(){return(e=r.toastPosition).bottom&&d.top&&(e.top=!1),e.top&&d.bottom&&(e.bottom=!1),e.right&&d.left&&(e.left=!1),e.left&&d.right&&(e.right=!1),d=angular.extend({},e),Object.keys(r.toastPosition).filter(function(e){return r.toastPosition[e]}).join(" ");var e};var p=firebase.database().ref("/settings/content"),g=s(p);g.$loaded().then(function(){r.toastdata=g,console.log("toastdata",r.toastdata)}),r.states=[{name:"Alabama",statename:"AL"},{name:"Alaska",statename:"AK"},{name:"Arizona",statename:"AZ"},{name:"Arkansas",statename:"AR"},{name:"California",statename:"CA"},{name:"Colorado",statename:"CO"},{name:"Connecticut",statename:"CT"},{name:"Delaware",statename:"DE"},{name:"Florida",statename:"FL"},{name:"Georgia",statename:"GA"},{name:"Hawaii",statename:"HI"},{name:"Idaho",statename:"ID"},{name:"Illinois",statename:"IL"},{name:"Indiana",statename:"IN"},{name:"Iowa",statename:"IA"},{name:"Kansas",statename:"KS"},{name:"Kentucky",statename:"KY"},{name:"Louisiana",statename:"LA"},{name:"Maine",statename:"ME"},{name:"Maryland",statename:"MD"},{name:"Massachusetts",statename:"MA"},{name:"Michigan",statename:"MI"},{name:"Minnesota",statename:"MN"},{name:"Mississippi",statename:"MS"},{name:"Missouri",statename:"MO"},{name:"Montana",statename:"MT"},{name:"Nebraska",statename:"NE"},{name:"Nevada",statename:"NV"},{name:"New Hampshire",statename:"NH"},{name:"New Jersey",statename:"NJ"},{name:"New Mexico",statename:"NM"},{name:"New York",statename:"NY"},{name:"North Carolina",statename:"NC"},{name:"North Dakota",statename:"ND"},{name:"Ohio",statename:"OH"},{name:"Oklahoma",statename:"OK"},{name:"Oregon",statename:"OR"},{name:"Pennsylvania",statename:"PA"},{name:"Rhode Island",statename:"RI"},{name:"South Carolina",statename:"SC"},{name:"South Dakota",statename:"SD"},{name:"Tennessee",statename:"TN"},{name:"Texas",statename:"TX"},{name:"Utah",statename:"UT"},{name:"Vermont",statename:"VT"},{name:"Virginia",statename:"VA"},{name:"Washington",statename:"WA"},{name:"West Virginia",statename:"WV"},{name:"Wisconsin",statename:"WI"},{name:"Wyoming",statename:"WY"}],AWS.config.region="us-east-1",new AWS.S3({params:{Bucket:"test3dmodel"}}),r.numberOfPages=function(e){console.log(e,r.videos.length),r.pageSize=parseInt(e),r.pagenum=Math.ceil(r.videos.length/parseInt(e))},r.upload=function(e){console.log("data",e),AWS.config.region="us-east-1";var a=e.state.statename,n="test3dmodel/"+a,o=new AWS.S3({params:{Bucket:n}});if(r.file)if(r.showloading=!0,console.log(r.file),"video/mp4"==r.file.type){var s=r.uniqueString()+"-"+r.file.name,t={file_name:s,access_level:l.currentuser.access_level,username:l.currentuser.username,s3location:a,file_type:"video/mp4",auth_token:l.currentuser.auth_token};i.post("https://api.skyebrowse.com:3000/api/UserModels/createFile",t,{"Content-Type":"application/json"}).then(function(e){console.log("createFile",e);var t={Key:s,ContentType:r.file.type,Body:r.file,ServerSideEncryption:"AES256"};o.putObject(t,function(e,t){if(console.log("inside putObject"),e)return console.log(e.message,e.code),r.showloading=!1,l.filename=null,u.show(u.simple().content(r.toastdata.uploadvideotoast).position(r.getToastPosition()).hideDelay(4e3)),!1;console.log("Video File Uploaded Successfully","Done"),function(e,t,a){console.log("inside callme",t,e,l.currentuser);var n={"Content-Type":"application/json"},o={file_name:t,access_level:l.currentuser.access_level,username:l.currentuser.username,s3location:a,file_type:"video/mp4",auth_token:l.currentuser.auth_token};i.post("https://api.skyebrowse.com:3000/api/UserModels/updateFileUploadStatus",o,n).then(function(e){console.log("update status",e),r.showloading=!1,l.filename=null,r.video={},c.path("/3dmodel/view3dmodel"),u.show(u.simple().content(r.toastdata.addvideotoast).position(r.getToastPosition()).hideDelay(4e3))},function(e){console.log("update status err",e),r.showloading=!1,l.filename=null,u.show(u.simple().content(e.data.error.message).position(r.getToastPosition()).hideDelay(4e3))})}(n,s,a)})},function(e){console.log("err createFile",e.data.error.message),r.showloading=!1,l.filename=null,u.show(u.simple().content(e.data.error.message).position(r.getToastPosition()).hideDelay(4e3))})}else console.log("Please upload mp4 file only"),r.showloading=!1,l.filename=null,u.show(u.simple().content(r.toastdata.videofilevalidatetoast).position(r.getToastPosition()).hideDelay(4e3));else console.log("Please select a file to upload"),u.show(u.simple().content(r.toastdata.videofilevalidatetoast).position(r.getToastPosition()).hideDelay(4e3))},r.uniqueString=function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=0;a<8;a++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}}]).filter("pagination",[function(){return function(e,t){return t=+t,e.slice(t)}}]).directive("file",["$rootScope",function(o){return{restrict:"AE",scope:{file:"@"},link:function(n,e,t){e.bind("change",function(e){var t=e.target.files,a=t[0];n.file=a,n.$parent.file=a,o.filename=a.name,console.log("scope file",n.file),console.log("$rootScope.filename",o.filename),n.$apply()})}}}]),angular.module("app.users").controller("adduserCtrl",["$scope","$firebaseArray","$firebaseObject","$localStorage","$location","$mdToast","$http","$rootScope",function(r,e,t,a,n,o,i,l){console.log("inside adduser"),0==a.skybrowselogin&&n.path("/page/signin"),r.chief=[],r.lieutenant=[],5==l.currentuser.access_level&&(r.admin=[],r.admin.push(l.currentuser)),r.managers=[],r.inputType="password",r.hideshow=!0,r.hideShowPassword=function(){r.hideshow=!r.hideshow,"password"==r.inputType?r.inputType="text":r.inputType="password"},r.showloading=!1,r.user={};var s={bottom:r.showdiv=!1,top:!0,left:!1,right:!0};r.toastPosition=angular.extend({},s),r.getToastPosition=function(){return(e=r.toastPosition).bottom&&s.top&&(e.top=!1),e.top&&s.bottom&&(e.bottom=!1),e.right&&s.left&&(e.left=!1),e.left&&s.right&&(e.right=!1),s=angular.extend({},e),Object.keys(r.toastPosition).filter(function(e){return r.toastPosition[e]}).join(" ");var e};var u=firebase.database().ref("/settings/content"),c=t(u);c.$loaded().then(function(){r.toastdata=c,console.log("toastdata",r.toastdata)});var d={"Content-Type":"application/json"},p={username:l.currentuser.username,manager_id:l.currentuser.id,auth_token:l.currentuser.auth_token};i.post("https://api.skyebrowse.com:3000/api/Consumer/getEmployees",p,d).then(function(e){if(console.log("managerdata",e.data.data),5==l.currentuser.access_level){for(var t=e.data.data,a=0;a<t.length;a++)4==t[a].access_level&&r.chief.push(t[a]);var o=0,s=r.chief.length;!function n(){if(o<s){var e={username:r.chief[o].username,manager_id:r.chief[o].id,auth_token:r.chief[o].auth_token};i.post("https://api.skyebrowse.com:3000/api/Consumer/getEmployees",e,d).then(function(e){console.log("lieutenant res data",e.data.data);for(var t=e.data.data,a=0;a<t.length;a++)3==t[a].access_level&&r.lieutenant.push(t[a]);o+=1,n()},function(e){console.log("lieutenant err",e),o+=1,n()})}}()}else 4==l.currentuser.access_level?(r.chief.push(l.currentuser),r.lieutenant=e.data.data):r.lieutenant.push(l.currentuser)},function(e){console.log("managerdata err",e)});var g={username:l.currentuser.username,auth_token:l.currentuser.auth_token};i.post("https://api.skyebrowse.com:3000/api/Authorization/getAllAuthLevels",g,d).then(function(e){console.log(e.data.data);var t=e.data.data;if(r.roles=[],5==l.currentuser.access_level)for(var a=0;a<t.length;a++)5!=t[a].id&&r.roles.push(t[a]);else if(4==l.currentuser.access_level)for(var a=0;a<t.length;a++)5!=t[a].id&&4!=t[a].id&&1!=t[a].id&&r.roles.push(t[a]);else if(3==l.currentuser.access_level)for(var a=0;a<t.length;a++)5!=t[a].id&&4!=t[a].id&&3!=t[a].id&&1!=t[a].id&&r.roles.push(t[a])},function(e){console.log("err get auth level",e)}),r.getmanagers=function(e){if(r.managers=[],console.log("data",e),4==e||1==e){console.log("$scope.admin",r.admin);for(var t=0;t<r.admin.length;t++)r.managers.push(r.admin[t])}else if(3==e){console.log("$scope.chief",r.chief);for(var t=0;t<r.chief.length;t++)console.log("inside for"),r.managers.push(r.chief[t]);console.log("$scope.managers",r.managers)}else if(2==e){console.log("$scope.lieutenant",r.lieutenant);for(var t=0;t<r.lieutenant.length;t++)r.managers.push(r.lieutenant[t])}},r.adduser=function(e){e.access_level=e.role,r.showloading=!0,console.log("adduser",e),i.post("https://api.skyebrowse.com:3000/api/Consumer/newConsumer",e,{"Content-Type":"application/json"}).then(function(e){console.log("add user",e),1==e.data.success?(r.showloading=!1,o.show(o.simple().content(r.toastdata.addusertoast).position(r.getToastPosition()).hideDelay(3e3)),r.user={},n.path("/viewuser")):(r.showloading=!1,o.show(o.simple().content(e.data.msg).position(r.getToastPosition()).hideDelay(3e3)))},function(e){console.log("err add user",e),r.showloading=!1,o.show(o.simple().content(e.data.msg).position(r.getToastPosition()).hideDelay(3e3))})}}]).controller("viewuserCtrl",["$scope","$firebaseArray","$firebaseObject","$localStorage","$mdDialog","$mdToast","$http","$location","$rootScope",function(u,e,t,a,n,o,c,s,d){0==a.skybrowselogin&&s.path("/page/signin"),u.curPage=0,u.pageSize=10,u.users=[],u.lieutenant=[],u.chief=[],u.demouser=[],u.officer=[];var r={bottom:u.showloading=!1,top:!0,left:!1,right:!0};u.toastPosition=angular.extend({},r),u.getToastPosition=function(){return(e=u.toastPosition).bottom&&r.top&&(e.top=!1),e.top&&r.bottom&&(e.bottom=!1),e.right&&r.left&&(e.left=!1),e.left&&r.right&&(e.right=!1),r=angular.extend({},e),Object.keys(u.toastPosition).filter(function(e){return u.toastPosition[e]}).join(" ");var e};var i=firebase.database().ref("/settings/content"),l=t(i);l.$loaded().then(function(){u.toastdata=l,console.log("toastdata",u.toastdata)});var p={"Content-Type":"application/json"},g={username:d.currentuser.username,manager_id:d.currentuser.id,auth_token:d.currentuser.auth_token};c.post("https://api.skyebrowse.com:3000/api/Consumer/getEmployees",g,p).then(function(e){if(console.log("managerdata",e.data.data),u.showloading=!0,3==d.currentuser.access_level){u.users=e.data.data;for(var t=0;t<u.users.length;t++)u.users[t].manager_id=d.currentuser.id,u.users[t].manager_username=d.currentuser.username;u.showloading=!1}else if(4==d.currentuser.access_level){u.lieutenant=e.data.data;var s=0,a=u.lieutenant.length;!function n(){if(s<a){u.lieutenant[s].manager_id=d.currentuser.id,u.lieutenant[s].manager_username=d.currentuser.username;var o={username:u.lieutenant[s].username,manager_id:u.lieutenant[s].id,auth_token:u.lieutenant[s].auth_token};c.post("https://api.skyebrowse.com:3000/api/Consumer/getEmployees",o,p).then(function(e){console.log("lieutenant res data",e.data.data);for(var t=e.data.data,a=0;a<t.length;a++)t[a].manager_id=o.manager_id,t[a].manager_username=o.username,u.officer.push(t[a]);s+=1,n()},function(e){console.log("lieutenant err",e),s+=1,n()})}}();for(var n=0;n<u.lieutenant.length;n++)u.users.push(u.lieutenant[n]);for(var o=0;o<u.officer.length;o++)u.users.push(u.officer[o]);u.showloading=!1}else if(5==d.currentuser.access_level){console.log("inside five");for(var r=e.data.data,i=0;i<r.length;i++)1==r[i].access_level?(r[i].manager_id=d.currentuser.id,r[i].manager_username=d.currentuser.username,u.demouser.push(r[i])):4==r[i].access_level&&u.chief.push(r[i]),i==parseInt(r.length-1)&&l();function l(){console.log("$scope.chief.length",u.chief.length);var l=0,e=u.chief.length;!function n(){if(l<e){u.chief[l].manager_id=d.currentuser.id,u.chief[l].manager_username=d.currentuser.username;var o={username:u.chief[l].username,manager_id:u.chief[l].id,auth_token:u.chief[l].auth_token};c.post("https://api.skyebrowse.com:3000/api/Consumer/getEmployees",o,p).then(function(e){console.log("chief res data",e.data.data);for(var t=e.data.data,a=0;a<t.length;a++)t[a].manager_id=o.manager_id,t[a].manager_username=o.username,u.lieutenant.push(t[a]);l+=1,n()},function(e){console.log("chief err",e),l+=1,n()})}else{var s=0,r=u.lieutenant.length;function i(){if(s<r){var n={username:u.lieutenant[s].username,manager_id:u.lieutenant[s].id,auth_token:u.lieutenant[s].auth_token};c.post("https://api.skyebrowse.com:3000/api/Consumer/getEmployees",n,p).then(function(e){console.log("lieutenant res data",e.data.data);for(var t=e.data.data,a=0;a<t.length;a++)t[a].manager_id=n.manager_id,t[a].manager_username=n.username,u.officer.push(t[a]);s+=1,i()},function(e){console.log("lieutenant err",e),s+=1,i()})}else{for(var e=0;e<u.chief.length;e++)u.users.push(u.chief[e]);for(var t=0;t<u.lieutenant.length;t++)u.users.push(u.lieutenant[t]);for(var a=0;a<u.officer.length;a++)u.users.push(u.officer[a]);for(var o=0;o<u.demouser.length;o++)u.users.push(u.demouser[o]);console.log("$scope.users",u.users),u.users.length&&(u.pagenum=Math.ceil(u.users.length/u.pageSize)),u.showloading=!1}}i()}}()}}},function(e){console.log("managerdata err",e)}),u.numberOfPages=function(e){u.pageSize=parseInt(e),u.pagenum=Math.ceil(u.users.length/parseInt(e))}}]).controller("edituserCtrl",["$scope","$stateParams","$firebaseArray","$firebaseObject","$localStorage","$location","$mdToast","$http",function(n,t,e,a,o,s,r,i){0==o.skybrowselogin&&s.path("/page/signin"),n.user={},n.showdiv=!1,n.showloading=!1,n.inputType="password",n.hideshow=!0;var l={bottom:!(n.hideShowPassword=function(){n.hideshow=!n.hideshow,"password"==n.inputType?n.inputType="text":n.inputType="password"}),top:!0,left:!1,right:!0};n.toastPosition=angular.extend({},l),n.getToastPosition=function(){return(e=n.toastPosition).bottom&&l.top&&(e.top=!1),e.top&&l.bottom&&(e.bottom=!1),e.right&&l.left&&(e.left=!1),e.left&&l.right&&(e.right=!1),l=angular.extend({},e),Object.keys(n.toastPosition).filter(function(e){return n.toastPosition[e]}).join(" ");var e};var u={username:$rootScope.currentuser.username,auth_token:$rootScope.currentuser.auth_token};i.post("https://api.skyebrowse.com:3000/api/Authorization/getAllAuthLevels",u,{"Content-Type":"application/json"}).then(function(e){console.log(e.data.data);var t=e.data.data;if(n.roles=[],5==$rootScope.currentuser.access_level)for(var a=0;a<t.length;a++)5!=t[a].id&&n.roles.push(t[a]);else if(4==$rootScope.currentuser.access_level)for(var a=0;a<t.length;a++)5!=t[a].id&&4!=t[a].id&&1!=t[a].id&&n.roles.push(t[a]);else if(3==$rootScope.currentuser.access_level)for(var a=0;a<t.length;a++)5!=t[a].id&&4!=t[a].id&&3!=t[a].id&&1!=t[a].id&&n.roles.push(t[a])},function(e){console.log("err get auth level",e)});var c=firebase.database().ref("/settings/content"),d=a(c);d.$loaded().then(function(){n.toastdata=d,console.log("toastdata",n.toastdata)});var p=firebase.database().ref("/users"),g=e(p);g.$loaded().then(function(){n.users=g;for(var e=0;e<n.users.length;e++)n.users[e].username==t.username&&(n.user=n.users[e],o.editid=n.users[e].$id)});var m=firebase.database().ref("/users/"+o.editid),f=a(m);f.$loaded().then(function(){o.nowedituser=f}),n.edituser=function(a){if(n.showloading=!0,console.log(a.role,o.nowedituser.role),o.nowedituser.role==a.role){var e=firebase.database().ref("/users/"+n.user.$id);e.child("name").set(a.name),e.child("mobile").set(a.mobile),e.child("role").set(a.role),e.child("username").set(a.username),e.child("gender").set(a.gender),a.email&&e.child("email").set(a.email),0!==Object.keys(o.userimage1).length&&e.child("image").set(o.userimage1),r.show(r.simple().content(n.toastdata.updateusertoast).position(n.getToastPosition()).hideDelay(3e3)),o.userimage1={},n.image1={},n.showloading=!1,s.path("/viewuser")}else{var e=firebase.database().ref("/users/"+n.user.$id);e.child("name").set(a.name),e.child("mobile").set(a.mobile),e.child("role").set(a.role),e.child("username").set(a.username),e.child("gender").set(a.gender),a.email&&e.child("email").set(a.email),0!==Object.keys(o.userimage1).length&&e.child("image").set(o.userimage1);var t={username:a.username,role:a.role,email:a.email,subject:"Updation in your Role"};i.post("https://send-mail-node-web.herokuapp.com/sendRoleUpdate/",t).then(function(e){console.log(e);var t=firebase.database().ref("/users/"+a.$id);t.child("updation").set(!1),r.show(r.simple().content(n.toastdata.updateusertoast).position(n.getToastPosition()).hideDelay(3e3)),n.showloading=!1,o.userimage1={},n.image1={},s.path("/viewuser")}).catch(function(e){console.log(e);var t=firebase.database().ref("/users/"+a.$id);t.child("updation").set(!0),r.show(r.simple().content(n.toastdata.mailresenttoast).position(n.getToastPosition()).hideDelay(3e3)),n.showloading=!1,o.userimage1={},n.image1={},s.path("/viewuser")})}}}]).directive("customOnChange",[function(){return{restrict:"A",link:function(e,t,a){var n=e.$eval(a.customOnChange);t.on("change",n),t.on("$destroy",function(){t.off()})}}}]).directive("onlyDigits",[function(){return{require:"ngModel",restrict:"A",link:function(e,t,a,n){n.$parsers.push(function(e){if(e){var t=e.replace(/[^0-9, +, -]/g,"");return t!==e&&(n.$setViewValue(t),n.$render()),parseInt(t,10)}})}}}]).filter("pagination",[function(){return function(e,t){return t=+t,e.slice(t)}}]);